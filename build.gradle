repositories {
    mavenCentral()
}

configurations {
    ftpAntTask
}

dependencies { 
     ftpAntTask 'org.apache.ant:ant-commons-net:1.7.0'
}

buildDir = '_site'

task clean << {
    ant.delete(dir: buildDir)
}


// Would be really nice for this task to check if anything has changed before rebuilding.
task build(dependsOn: clean) << {
    def process = ['jekyll'].execute()
    process.consumeProcessOutput System.out, System.err
    process.waitFor()
}

task upload(dependsOn: build) {
    ant.taskdef(name: 'ftp', classname: 'org.apache.tools.ant.taskdefs.optional.net.FTP',
                classpath: configurations.ftpAntTask.asPath)

    doLast {
        ant.ftp(server: uploadServer, userid: uploadUsername, password: uploadPassword,
                remoteDir: uploadDir) {
            fileset(dir: buildDir)
        }
    }
}
